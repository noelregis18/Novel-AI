# Netlify Deployment Guide for Novel AI

## üöÄ Deployment Configuration

### Build Settings
| Setting | Value |
|---------|-------|
| **Base Directory** | `./` |
| **Build Command** | `npm run build` |
| **Publish Directory** | `build` |

### Environment Variables
Set these in your Netlify dashboard under **Site settings > Environment variables**:

| Variable Name | Value | Required |
|---------------|-------|----------|
| `REACT_APP_CLERK_PUBLISHABLE_KEY` | `pk_test_dGhhbmtmdWwtbGFtYi0zNS5jbGVyay5hY2NvdW50cy5kZXYk` | ‚úÖ Yes |
| `WINSTON_API_KEY` | `DM2iLRgYPos3uQ0V9CqVLVvyo75d1KtJVYvcl4UE382db097` | ‚úÖ Yes |
| `REACT_APP_API_URL` | `https://novel-ai1.netlify.app/.netlify/functions` | ‚úÖ Yes |
| `NODE_ENV` | `production` | ‚ùå Optional |

**Important:** The `REACT_APP_API_URL` should be the base functions URL. The code will automatically append `/aiContentDetection` to it.

## üìÅ Project Structure
```
novel-ai/
‚îú‚îÄ‚îÄ netlify/
‚îÇ   ‚îú‚îÄ‚îÄ functions/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aiContentDetection.js    # Winston AI API endpoint
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test.js                  # Test function
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ debug.js                 # Debug function
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json             # Function dependencies
‚îÇ   ‚îî‚îÄ‚îÄ netlify.toml                 # Netlify configuration
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ App.js                       # Updated to use env vars
‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ       ‚îî‚îÄ‚îÄ CheckPage.js             # Updated API endpoint
‚îî‚îÄ‚îÄ package.json
```

## üîß What's Changed

### 1. Netlify Functions Setup
- ‚úÖ Created `netlify/functions/aiContentDetection.js`
- ‚úÖ Added CORS support for cross-origin requests
- ‚úÖ Environment variable integration for Winston API key
- ‚úÖ Error handling and logging
- ‚úÖ Test and debug functions for troubleshooting

### 2. Frontend Updates
- ‚úÖ Updated `CheckPage.js` to use Netlify Function endpoint
- ‚úÖ Updated `App.js` to use environment variable for Clerk key
- ‚úÖ Added fallback values for development
- ‚úÖ Enhanced debugging and logging

### 3. Configuration Files
- ‚úÖ Created `netlify.toml` for build configuration
- ‚úÖ Added API redirects from `/api/*` to `/.netlify/functions/*`

## üåê API Endpoints

### Production API URL
```
https://novel-ai1.netlify.app/.netlify/functions/aiContentDetection
```

### Test Function URL
```
https://novel-ai1.netlify.app/.netlify/functions/test
```

### Debug Function URL
```
https://novel-ai1.netlify.app/.netlify/functions/debug
```

### Local Development
```
http://localhost:8888/.netlify/functions/aiContentDetection
```

## üöÄ Deployment Steps

### 1. Push to Git
```bash
git add .
git commit -m "Fix API URL construction and add debugging"
git push origin main
```

### 2. Connect to Netlify
1. Go to [Netlify Dashboard](https://app.netlify.com/)
2. Click "New site from Git"
3. Connect your repository
4. Set build settings:
   - Build command: `npm run build`
   - Publish directory: `build`

### 3. Set Environment Variables
In Netlify dashboard > Site settings > Environment variables:
- Add all variables listed above

### 4. Deploy
Netlify will automatically build and deploy your site.

## üß™ Testing

### Test the API Endpoint
```bash
curl -X POST https://novel-ai1.netlify.app/.netlify/functions/aiContentDetection \
  -H "Content-Type: application/json" \
  -d '{"text": "This is a test message with more than 300 characters to ensure it meets the minimum requirement for the Winston AI API. The API will analyze this text and determine if it was generated by artificial intelligence or written by a human."}'
```

### Test the Test Function
```bash
curl https://novel-ai1.netlify.app/.netlify/functions/test
```

### Test the Debug Function
```bash
curl https://novel-ai1.netlify.app/.netlify/functions/debug
```

### Test the Frontend
1. Visit `https://novel-ai1.netlify.app`
2. Navigate to the AI Detection page
3. Paste text and test the functionality
4. Check browser console for debugging information

## üîç Troubleshooting

### Common Issues

1. **Method not allowed (405)**
   - Check that the frontend is making POST requests
   - Verify the API URL is correct
   - Check browser console for the actual URL being called

2. **Function not found (404)**
   - Check that `netlify.toml` is in the root directory
   - Verify the functions directory structure
   - Try the test function first: `/api/test`

3. **CORS errors**
   - The function includes CORS headers
   - Check browser console for specific errors

4. **API key errors**
   - Verify `WINSTON_API_KEY` is set in Netlify environment variables
   - Check function logs in Netlify dashboard

5. **Build failures**
   - Check that `node-fetch` is installed in functions directory
   - Verify Node.js version compatibility

### Function Logs
View function logs in Netlify dashboard:
1. Go to Functions tab
2. Click on `aiContentDetection`
3. Check the logs for any errors

### Browser Console Debugging
1. Open browser Developer Tools (F12)
2. Go to Console tab
3. Try the AI detection feature
4. Look for logs showing:
   - Environment variables
   - Final API URL
   - Request payload
   - Response status and headers

## üîí Security Notes

- ‚úÖ API keys are now in environment variables
- ‚úÖ CORS is properly configured
- ‚úÖ Input validation is in place
- ‚ö†Ô∏è Consider using production API keys for live deployment
- ‚ö†Ô∏è Review CORS origins for production use

## üìà Next Steps

1. **Production API Keys**: Replace test keys with production keys
2. **Domain Configuration**: Set up custom domain if needed
3. **Monitoring**: Set up error tracking and analytics
4. **Rate Limiting**: Consider adding rate limiting to the function
5. **Caching**: Implement caching for better performance

## üéâ Success!

Your Novel AI application is now ready for production deployment on Netlify with a fully functional Winston AI integration backend! 